import{b as ge}from"./vue-router-38a26824.js";import{x as A}from"./axios-0b03b3f1.js";import{e as z}from"./index-a67b3544.js";import{r as ye,u as se,g as Ve}from"./supabase-a2e67656.js";import{d as ne}from"./avatar-1-3c68e17a.js";import{_ as Q}from"./@fawmi-f1769799.js";import{p as S,t as W,o as I,A as de,e as ue,a as O,q as N,r as v,C as T,B as F,D as Y,n as Z,x as ce,E as ee,F as ie,d as B,m as G,v as he,G as xe,H as K,w as Ce}from"./vuetify-41d014fb.js";import{b5 as Ue,f,aP as ke,o as w,J,bs as o,X as e,W as V,a as l,u as y,b1 as x,c as P,F as L,i as X,I as me,ay as pe,aO as oe,aI as ve,aF as fe,bx as we,L as te}from"./@vue-00b20f2b.js";import Ee from"./_...all_-24df20e6.js";import"./@iconify-452d8fcb.js";import"./mitt-f7ef348c.js";import"./@supabase-9ce37a4a.js";import"./pinia-b2002cd0.js";import"./@googlemaps-b4d342ab.js";import"./fast-deep-equal-099ec698.js";import"./apexcharts-clevision-d64c90db.js";import"./supercluster-6504d485.js";import"./kdbush-ac640998.js";import"./pica-f1c996d9.js";const $e={class:"text-center mb-3"},Ae={class:"mt-2"},Oe={__name:"EditUserForm",props:{isOpen:{type:Boolean,required:!0},user:{type:Object,required:!0}},emits:["update:isOpen","save"],setup($,{emit:g}){const a=$,{isOpen:k,user:t}=Ue(a),E=f(null),C=f(""),_=f(!1),h=f(null),q=f(),D=f(!1),m=f(""),p=d=>{m.value=d,window.clearTimeout(r),document.getElementById("error").scrollIntoView();var r=setTimeout(()=>{m.value=""},5e3)},u=["Director de Obra","Capataz","Ayudante de Obra","Peon"],n=()=>{g("update:isOpen",!1)},c=d=>{const r=d.target.files[0];if(h.value=r,r){const R=new FileReader;R.readAsDataURL(r),R.onload=()=>{typeof R.result=="string"&&(t.value.avatarUrl=R.result)}}},s=async()=>{if(t.value.nombres=="")p("El usuario debe tener un nombre");else if(t.value.apellidos=="")p("El usuario debe tener apellidos");else if(t.value.celular=="")p("El usuario debe tener un numero celular");else if(t.value.correo=="")p("El usuario debe tener un correo");else if(t.value.contraseña=="")p("El usuario debe tener una contraseña");else{_.value=!0;try{if(h.value&&(t.value.avatarUrl?await ye(h.value,t.value.numerodeid):await se(h.value,t.value.numerodeid)),await A.put(`http://desarrollo-constructora-back.onrender.com/constructora/v1/Usuario/${t.value.numerodeid}/`,t.value),u.includes(C.value)&&C.value!==t.value.rol){const d={"Director de Obra":"DirectorDeObra",Capataz:"Capataz","Ayudante de Obra":"AyudanteDeObra",Peon:"Peon"},r={"Director de Obra":"directorid",Capataz:"capatazid","Ayudante de Obra":"ayudanteid",Peon:"peonid"},R=d[t.value.rol],b=r[t.value.rol];if(R&&b){const H=(await A.get(`http://desarrollo-constructora-back.onrender.com/constructora/v1/${R}/`)).data.find(be=>be.numerodeid===t.value.numerodeid);H&&H[b]&&await A.delete(`http://desarrollo-constructora-back.onrender.com/constructora/v1/${R}/${H[b]}/`)}const le=d[C.value],ae=r[C.value];if(le&&ae){const re=await A.post(`http://desarrollo-constructora-back.onrender.com/constructora/v1/${le}/`,{numerodeid:t.value.numerodeid});t.value[ae]=re.data.id}g("save",{...t.value,rol:C.value}),i()}else g("save",{...t.value});n()}catch(d){console.error("Error al guardar el usuario:",d)}finally{_.value=!1}}},i=()=>{E.value.reset(),C.value=""},j=()=>{D.value=!D.value},M=["TI","CC","CE"],U=["Masculino","Femenino","Neutro","Prefiere no decirlo"];return(d,r)=>{const R=ke("VcardText");return w(),J(ee,{modelValue:y(k),"onUpdate:modelValue":r[11]||(r[11]=b=>X(k)?k.value=b:null),"max-width":"600"},{default:o(()=>[e(S,null,{default:o(()=>[e(W,null,{default:o(()=>[V(" Editar Usuario ")]),_:1}),e(I,null,{default:o(()=>[e(de,{ref_key:"form",ref:E},{default:o(()=>[l("div",$e,[e(ue,{size:100,image:y(t).avatarUrl||y(ne)},null,8,["image"]),l("div",Ae,[e(O,{onClick:r[0]||(r[0]=b=>q.value.click())},{default:o(()=>[V(" Cambiar Foto ")]),_:1}),l("input",{ref_key:"refInputEl",ref:q,type:"file",onChange:c,hidden:""},null,544)])]),e(N,null,{default:o(()=>[e(v,{cols:"12",md:"6"},{default:o(()=>[e(T,{modelValue:y(t).tipodeid,"onUpdate:modelValue":r[1]||(r[1]=b=>y(t).tipodeid=b),items:M,label:"Tipo de ID",required:"",class:"mb-3"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:o(()=>[e(F,{modelValue:y(t).numerodeid,"onUpdate:modelValue":r[2]||(r[2]=b=>y(t).numerodeid=b),label:"Número de ID",required:"",class:"mb-3",readonly:"",style:{backgroundColor:"#f0f0f0",pointerEvents:"none"}},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:o(()=>[e(F,{modelValue:y(t).nombres,"onUpdate:modelValue":r[3]||(r[3]=b=>y(t).nombres=b),label:"Nombres",required:"",class:"mb-3"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:o(()=>[e(F,{modelValue:y(t).apellidos,"onUpdate:modelValue":r[4]||(r[4]=b=>y(t).apellidos=b),label:"Apellidos",required:"",class:"mb-3"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:o(()=>[e(T,{modelValue:y(t).genero,"onUpdate:modelValue":r[5]||(r[5]=b=>y(t).genero=b),items:U,label:"Género",required:"",class:"mb-3"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:o(()=>[e(F,{modelValue:y(t).celular,"onUpdate:modelValue":r[6]||(r[6]=b=>y(t).celular=b),label:"Celular",required:"",class:"mb-3",type:"number"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:o(()=>[e(F,{modelValue:y(t).correo,"onUpdate:modelValue":r[7]||(r[7]=b=>y(t).correo=b),label:"Correo",required:"",class:"mb-3",type:"email"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:o(()=>[e(F,{modelValue:y(t).contraseña,"onUpdate:modelValue":r[8]||(r[8]=b=>y(t).contraseña=b),label:"Contraseña",required:"",class:"mb-3",type:D.value?"text":"password","append-icon":"mdi-eye","onClick:append":j},null,8,["modelValue","type"])]),_:1}),e(v,{cols:"12",md:"6"},{default:o(()=>[e(F,{modelValue:y(t).rol,"onUpdate:modelValue":r[9]||(r[9]=b=>y(t).rol=b),label:"Rol actual",required:"",readonly:"",class:"mb-3",style:{backgroundColor:"#f0f0f0",pointerEvents:"none"}},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:o(()=>[e(T,{modelValue:C.value,"onUpdate:modelValue":r[10]||(r[10]=b=>C.value=b),items:u,label:"Cambiar Rol",class:"mb-3"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(Y,null,{default:o(()=>[e(R,{style:{color:"darkred"}},{default:o(()=>[V(x(m.value),1)]),_:1}),e(Z),e(O,{color:"blue darken-1",text:"",onClick:i},{default:o(()=>[V(" Resetear ")]),_:1}),e(O,{color:"blue darken-1",text:"",onClick:n},{default:o(()=>[V(" Cancelar ")]),_:1}),e(O,{color:"blue darken-1",disabled:_.value,onClick:s},{default:o(()=>[_.value?(w(),P(L,{key:0},[e(ce,{indeterminate:"",size:"20"}),V(" Guardando... ")],64)):(w(),P(L,{key:1},[V(" Guardar ")],64))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},Ie=Q(Oe,[["__scopeId","data-v-8766c0eb"]]);const _e=$=>(ve("data-v-6094487b"),$=$(),fe(),$),De=_e(()=>l("thead",null,[l("tr",null,[l("th",{class:"text-uppercase"}," Foto de Usuario "),l("th",{class:"text-uppercase"}," Tipo de ID "),l("th",{class:"text-uppercase"}," Número de ID "),l("th",null," Nombres "),l("th",null," Apellidos "),l("th",null," Genero "),l("th",null," Celular "),l("th",null," Correo "),l("th",null," Activo "),l("th",null," Rol "),l("th",null," Acciones ")])],-1)),Re={class:"text-center avatar-container"},Fe={class:"avatar-wrapper"},Pe=["src"],qe=_e(()=>l("span",{class:"status-indicator"},null,-1)),Le={class:"text-center"},Se={class:"text-center"},ze={class:"text-center"},Te={class:"text-center"},Ge={class:"text-center"},Ne={class:"text-center"},Be={class:"text-center"},je={class:"text-center"},Me={class:"text-center"},We={class:"text-center action-buttons"},Je={__name:"EditableUsersList",setup($){const g=f([]),a=f({}),k=f(!1),t=f(!1),E=f(""),C=async()=>{try{const n=[{role:"Director de Obra",url:"http://desarrollo-constructora-back.onrender.com/constructora/v1/DirectorDeObra/"},{role:"Capataz",url:"http://desarrollo-constructora-back.onrender.com/constructora/v1/Capataz/"},{role:"Ayudante de Obra",url:"http://desarrollo-constructora-back.onrender.com/constructora/v1/AyudanteDeObra/"},{role:"Peon",url:"http://desarrollo-constructora-back.onrender.com/constructora/v1/Peon/"}],c=await Promise.all(n.map(i=>A.get(i.url))),s={};return c.forEach((i,j)=>{const M=n[j].role;i.data.forEach(U=>{s[U.numerodeid]||(s[U.numerodeid]=[]),s[U.numerodeid].push(M)})}),s}catch(n){return console.error("Error al obtener los roles de los usuarios:",n),{}}},_=async()=>{try{const c=(await A.get("http://desarrollo-constructora-back.onrender.com/constructora/v1/Usuario/")).data,s=await C();g.value=c.filter(i=>i.activo).map(i=>({numerodeid:i.numerodeid,nombres:i.nombres,apellidos:i.apellidos,tipodeid:i.tipodeid,celular:i.celular,genero:i.genero,contraseña:i.contraseña,correo:i.correo,activo:i.activo,rol:s[i.numerodeid]?s[i.numerodeid].join(", "):"Sin rol asignado",avatarUrl:Ve(i.numerodeid)}))}catch(n){console.error("Error al obtener los usuarios:",n)}},h=me(()=>E.value?g.value.filter(n=>n.rol.toLowerCase().includes(E.value.toLowerCase())):g.value);pe(()=>{_(),z.on("users",_),z.on("user-create",_),z.on("POST-ROL",_)});const q=n=>{a.value={...n},k.value=!0},D=n=>{const c=g.value.findIndex(s=>s.numerodeid===n.numerodeid);c!==-1&&(g.value[c]={...n})},m=n=>{a.value={...n},t.value=!0},p=async n=>{try{const c=a.value;await A.put(`http://desarrollo-constructora-back.onrender.com/constructora/v1/Usuario/${c.numerodeid}/`,{...c,activo:!1}),g.value=g.value.filter(s=>s.numerodeid!==c.numerodeid),console.log(`Usuario ${c.nombres} archivado con éxito`),z.emit("user-archived")}catch(c){console.error("Error al archivar el usuario:",c)}finally{t.value=!1}},u=["Director de Obra","Capataz","Ayudante de Obra","Peon"];return(n,c)=>(w(),P(L,null,[e(N,null,{default:o(()=>[e(v,{cols:"12"},{default:o(()=>[e(S,null,{default:o(()=>[e(W,null,{default:o(()=>[V(" Lista de Usuarios ")]),_:1}),e(I,null,{default:o(()=>[e(v,{cols:"12",md:"2"},{default:o(()=>[e(T,{modelValue:E.value,"onUpdate:modelValue":c[0]||(c[0]=s=>E.value=s),label:"Filtrar por rol",outlined:"",dense:"",clearable:"",placeholder:"Ingrese el rol",items:u},null,8,["modelValue"])]),_:1}),e(ie,null,{default:o(()=>[De,l("tbody",null,[(w(!0),P(L,null,oe(h.value,s=>(w(),P("tr",{key:s.numerodeid},[l("td",Re,[l("div",Fe,[l("img",{src:s.avatarUrl,alt:"Avatar",class:"avatar-img",onError:c[1]||(c[1]=i=>i.target.src=y(ne))},null,40,Pe),qe])]),l("td",Le,x(s.tipodeid),1),l("td",Se,x(s.numerodeid),1),l("td",ze,x(s.nombres),1),l("td",Te,x(s.apellidos),1),l("td",Ge,x(s.genero),1),l("td",Ne,x(s.celular),1),l("td",Be,x(s.correo),1),l("td",je,x(s.activo?"Sí":"No"),1),l("td",Me,x(s.rol),1),l("td",We,[e(O,{icon:"",style:{marginLeft:"0.3rem",marginRight:"0.3rem"},onClick:i=>q(s)},{default:o(()=>[e(B,null,{default:o(()=>[V("mdi-pencil")]),_:1})]),_:2},1032,["onClick"]),e(O,{icon:"",style:{marginLeft:"0.3rem"},onClick:i=>m(s)},{default:o(()=>[e(B,null,{default:o(()=>[V("mdi-archive")]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(Ie,{isOpen:k.value,"onUpdate:isOpen":c[2]||(c[2]=s=>k.value=s),user:a.value,onSave:D},null,8,["isOpen","user"]),e(ee,{modelValue:t.value,"onUpdate:modelValue":c[4]||(c[4]=s=>t.value=s),"max-width":"500px"},{default:o(()=>[e(S,null,{default:o(()=>[e(W,{class:"headline"},{default:o(()=>[V(" Confirmar Archivo ")]),_:1}),e(I,null,{default:o(()=>[V(" ¿Estás seguro de que deseas archivar este usuario? ")]),_:1}),e(Y,null,{default:o(()=>[e(Z),e(O,{color:"blue darken-1",text:"",onClick:c[3]||(c[3]=s=>t.value=!1)},{default:o(()=>[V(" Cancelar ")]),_:1}),e(O,{color:"blue darken-1",text:"",onClick:p},{default:o(()=>[V(" Confirmar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},He=Q(Je,[["__scopeId","data-v-6094487b"]]),Ke=l("code",null,"Usuarios activos",-1),Xe={__name:"UsersList",setup($){return(g,a)=>(w(),J(N,null,{default:o(()=>[e(v,{cols:"12"},{default:o(()=>[e(S,{title:"Usuarios"},{default:o(()=>[e(I,null,{default:o(()=>[Ke]),_:1}),e(He)]),_:1})]),_:1})]),_:1}))}};const Qe=$=>(ve("data-v-35ac697d"),$=$(),fe(),$),Ye=Qe(()=>l("thead",null,[l("tr",null,[l("th",{class:"text-uppercase"}," Tipo de ID "),l("th",{class:"text-uppercase"}," Número de ID "),l("th",null," Nombres "),l("th",null," Apellidos "),l("th",null," Genero "),l("th",null," Celular "),l("th",null," Correo "),l("th",null," Activo "),l("th",null," Rol "),l("th",null," Acciones ")])],-1)),Ze={class:"text-center"},eo={class:"text-center"},oo={class:"text-center"},lo={class:"text-center"},ao={class:"text-center"},ro={class:"text-center"},to={class:"text-center"},so={class:"text-center"},no={class:"text-center"},uo={class:"text-center action-buttons"},co={__name:"EditableArchivedUsersList",setup($){const g=f([]),a=f(""),k=f(!1),t=f({}),E=async()=>{try{const m=[{role:"Director de Obra",url:"http://desarrollo-constructora-back.onrender.com/constructora/v1/DirectorDeObra/"},{role:"Capataz",url:"http://desarrollo-constructora-back.onrender.com/constructora/v1/Capataz/"},{role:"Ayudante de Obra",url:"http://desarrollo-constructora-back.onrender.com/constructora/v1/AyudanteDeObra/"},{role:"Peon",url:"http://desarrollo-constructora-back.onrender.com/constructora/v1/Peon/"}],p=await Promise.all(m.map(n=>A.get(n.url))),u={};return p.forEach((n,c)=>{const s=m[c].role;n.data.forEach(i=>{u[i.numerodeid]||(u[i.numerodeid]=[]),u[i.numerodeid].push(s)})}),u}catch(m){return console.error("Error al obtener los roles de los usuarios:",m),{}}},C=me(()=>a.value?g.value.filter(m=>m.rol.toLowerCase().includes(a.value.toLowerCase())):g.value),_=async()=>{try{const p=(await A.get("http://desarrollo-constructora-back.onrender.com/constructora/v1/Usuario/")).data,u=await E();g.value=p.filter(n=>!n.activo).map(n=>({numerodeid:n.numerodeid,nombres:n.nombres,apellidos:n.apellidos,tipodeid:n.tipodeid,celular:n.celular,genero:n.genero,contraseña:n.contraseña,correo:n.correo,activo:n.activo,rol:u[n.numerodeid]?u[n.numerodeid].join(", "):"Sin rol asignado"}))}catch(m){console.error("Error al obtener los usuarios:",m)}};pe(()=>{_(),z.on("user-archived",_),z.on("POST-ROL",_)});const h=m=>{t.value={...m},k.value=!0},q=async m=>{try{const p=t.value;await A.put(`http://desarrollo-constructora-back.onrender.com/constructora/v1/Usuario/${p.numerodeid}/`,{...p,activo:!0}),g.value=g.value.filter(u=>u.numerodeid!==p.numerodeid),console.log(`Usuario ${p.nombres} restaurado con éxito`),z.emit("users")}catch(p){console.error("Error al restaurar el usuario:",p)}finally{k.value=!1}},D=["Director de Obra","Capataz","Ayudante de Obra","Peon"];return(m,p)=>(w(),P(L,null,[e(N,null,{default:o(()=>[e(v,{cols:"12"},{default:o(()=>[e(S,null,{default:o(()=>[e(W,null,{default:o(()=>[V(" Lista de Usuarios Archivados ")]),_:1}),e(v,{cols:"12",md:"2"},{default:o(()=>[e(T,{modelValue:a.value,"onUpdate:modelValue":p[0]||(p[0]=u=>a.value=u),label:"Filtrar por rol",outlined:"",dense:"",clearable:"",placeholder:"Ingrese el rol",items:D},null,8,["modelValue"])]),_:1}),e(I,null,{default:o(()=>[e(ie,null,{default:o(()=>[Ye,l("tbody",null,[(w(!0),P(L,null,oe(y(C),u=>(w(),P("tr",{key:u.numerodeid},[l("td",Ze,x(u.tipodeid),1),l("td",eo,x(u.numerodeid),1),l("td",oo,x(u.nombres),1),l("td",lo,x(u.apellidos),1),l("td",ao,x(u.genero),1),l("td",ro,x(u.celular),1),l("td",to,x(u.correo),1),l("td",so,x(u.activo?"Sí":"No"),1),l("td",no,x(u.rol),1),l("td",uo,[e(O,{icon:"",style:{marginLeft:"0.3rem"},onClick:n=>h(u)},{default:o(()=>[e(B,null,{default:o(()=>[V("mdi-restore")]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ee,{modelValue:k.value,"onUpdate:modelValue":p[2]||(p[2]=u=>k.value=u),"max-width":"500px"},{default:o(()=>[e(S,null,{default:o(()=>[e(W,{class:"headline"},{default:o(()=>[V(" Confirmar Archivo ")]),_:1}),e(I,null,{default:o(()=>[V(" ¿Estás seguro de que deseas archivar este usuario? ")]),_:1}),e(Y,null,{default:o(()=>[e(Z),e(O,{color:"blue darken-1",text:"",onClick:p[1]||(p[1]=u=>k.value=!1)},{default:o(()=>[V(" Cancelar ")]),_:1}),e(O,{color:"blue darken-1",text:"",onClick:q},{default:o(()=>[V(" Confirmar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},io=Q(co,[["__scopeId","data-v-35ac697d"]]),mo=l("code",null,"Usuarios archivados",-1),po={__name:"UsersArchived",setup($){return(g,a)=>(w(),J(N,null,{default:o(()=>[e(v,{cols:"12"},{default:o(()=>[e(S,{title:"Usuarios"},{default:o(()=>[e(I,null,{default:o(()=>[mo]),_:1}),e(io)]),_:1})]),_:1})]),_:1}))}},vo={class:"d-flex flex-column gap-5"},fo={class:"text-body-1 mb-0",style:{color:"darkred"}},_o=l("form",{class:"d-flex flex-column gap-5"},[l("p",{class:"text-body-1 mb-0"}," Completa los siguientes campos para añadir un usuario ")],-1),bo={class:"d-flex flex-column justify-center gap-5"},go={class:"d-flex flex-wrap gap-2"},yo=l("span",{class:"d-none d-sm-block"},"Upload new photo",-1),Vo=l("span",{class:"d-none d-sm-block"},"Reset",-1),ho=l("p",{class:"text-body-1 mb-0"}," Allowed JPG, GIF or PNG. Max size of 800K ",-1),xo=l("form",{class:"d-flex flex-column gap-5"},[l("p",{class:"text-body-1 mb-0"}," Información personal de Usuario ")],-1),Co=l("form",{class:"d-flex flex-column gap-5"},[l("p",{class:"text-body-1 mb-0"}," Datos adicionales ")],-1),Uo=l("form",{class:"d-flex flex-column gap-5"},[l("p",{class:"text-body-1 mb-0"}," Asignacion de Rol del Usuario ")],-1),ko={__name:"UsersCreate",setup($){const g={numerodeid:"",nombres:"",apellidos:"",tipodeid:"Selecciona",celular:"",genero:"Selecciona",contraseña:"",correo:"",activo:!0,rol:"Selecciona",avatarImg:""},a=f(structuredClone(g));f(!1);const k=f(null),t=f(!1),E=f(!1),C=f(!1);f([]);const _=f(null),h=f(),q=()=>{a.value=structuredClone(g),C.value=!1},D=()=>{C.value=!C.value},m=["TI","CC","CE"],p=["Masculino","Femenino","Neutro","Prefiere no decirlo"],u=["Director de Obra","Capataz","Ayudante de Obra","Peon"],n=async()=>{if(_.value==null)s("El usuario debe tener una foto");else if(a.value.tipodeid=="Selecciona")s("Debe seleccionar el tipo de id");else if(a.value.numerodeid=="")s("El usuario debe tener un numero de identificación");else if(a.value.nombres=="")s("El usuario debe tener un nombre");else if(a.value.apellidos=="")s("El usuario debe tener apellidos");else if(a.value.genero=="Selecciona")s("debe seleccionar el genero del usuario");else if(a.value.celular=="")s("El usuario debe tener un numero celular");else if(a.value.correo=="")s("El usuario debe tener un correo");else if(a.value.contraseña=="")s("El usuario debe tener una contraseña");else if(a.value.rol=="Selecciona")s("El usuario debe tener un rol asignado");else{if(E.value=!0,!k.value.validate()){E.value=!1;return}try{const d=(await A.post("http://desarrollo-constructora-back.onrender.com/constructora/v1/Usuario/",{numerodeid:a.value.numerodeid,nombres:a.value.nombres,apellidos:a.value.apellidos,tipodeid:a.value.tipodeid,celular:a.value.celular,genero:a.value.genero,contraseña:a.value.contraseña,correo:a.value.correo,activo:!0})).data.numerodeid;console.log("Usuario creado con éxito, ID:",d),_.value&&await se(_.value,d),await i(),z.emit("user-create"),q()}catch(U){console.error("Error al crear el usuario:",U)}finally{E.value=!1}}},c=f(""),s=U=>{const d=document.getElementById("errorItem");c.value=U,d.style.display="block",window.scroll({top:0,left:0,behavior:"smooth"}),setTimeout(()=>{d.style.display="none"},2e3)},i=async()=>{try{const U={numerodeid:a.value.numerodeid};a.value.rol==="Director de Obra"?(await A.post("http://desarrollo-constructora-back.onrender.com/constructora/v1/DirectorDeObra/",U),console.log("Rol Director de Obra asignado")):a.value.rol==="Capataz"?(await A.post("http://desarrollo-constructora-back.onrender.com/constructora/v1/Capataz/",U),console.log("Rol Capataz asignado")):a.value.rol==="Ayudante de Obra"?(await A.post("http://desarrollo-constructora-back.onrender.com/constructora/v1/AyudanteDeObra/",U),console.log("Rol Ayudante de Obra asignado")):a.value.rol==="Peon"?(await A.post("http://desarrollo-constructora-back.onrender.com/constructora/v1/Peon/",U),console.log("Rol Peon asignado")):console.error("Rol no válido:",a.value.rol)}catch(U){console.error("Error al asignar el rol:",U)}},j=U=>{const d=U.target.files[0];if(_.value=d,d){const r=new FileReader;r.readAsDataURL(d),r.onload=()=>{typeof r.result=="string"&&(a.value.avatarImg=r.result)}}},M=()=>{a.value.avatarImg=g.avatarImg};return(U,d)=>(w(),J(N,{justify:"center"},{default:o(()=>[e(v,{cols:"12",md:"8"},{default:o(()=>[e(S,{style:{"margin-bottom":"1vh",display:"none"},id:"errorItem"},{default:o(()=>[e(I,null,{default:o(()=>[l("form",vo,[l("p",fo,x(c.value),1)])]),_:1})]),_:1}),e(S,{title:"Crear Usuario"},{default:o(()=>[e(I,null,{default:o(()=>[_o]),_:1}),e(G),e(I,null,{default:o(()=>[e(de,{ref_key:"form",ref:k,modelValue:t.value,"onUpdate:modelValue":d[10]||(d[10]=r=>t.value=r),class:"mt-6"},{default:o(()=>[e(N,null,{default:o(()=>[e(I,{class:"d-flex"},{default:o(()=>[e(ue,{rounded:"lg",size:"200",class:"me-6",image:a.value.avatarImg},null,8,["image"]),l("form",bo,[l("div",go,[e(O,{color:"primary",onClick:d[0]||(d[0]=r=>{var R;return(R=h.value)==null?void 0:R.click()})},{default:o(()=>[e(B,{icon:"bx-cloud-upload",class:"d-sm-none"}),yo]),_:1}),l("input",{ref_key:"refInputEl",ref:h,type:"file",name:"file",accept:".jpeg,.png,.jpg,GIF",hidden:"",onChange:j},null,544),e(O,{type:"reset",color:"error",variant:"tonal",onClick:M},{default:o(()=>[Vo,e(B,{icon:"bx-refresh",class:"d-sm-none"})]),_:1})]),ho])]),_:1}),e(G),e(I,null,{default:o(()=>[xo]),_:1}),e(G),e(v,{cols:"12",md:"6"},{default:o(()=>[e(T,{modelValue:a.value.tipodeid,"onUpdate:modelValue":d[1]||(d[1]=r=>a.value.tipodeid=r),items:m,label:"Tipo de ID",required:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:o(()=>[e(F,{modelValue:a.value.numerodeid,"onUpdate:modelValue":d[2]||(d[2]=r=>a.value.numerodeid=r),label:"Número de ID",required:"",type:"number"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:o(()=>[e(F,{modelValue:a.value.nombres,"onUpdate:modelValue":d[3]||(d[3]=r=>a.value.nombres=r),label:"Nombres",required:"",type:"text"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:o(()=>[e(F,{modelValue:a.value.apellidos,"onUpdate:modelValue":d[4]||(d[4]=r=>a.value.apellidos=r),label:"Apellidos",type:"text",required:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:o(()=>[e(T,{modelValue:a.value.genero,"onUpdate:modelValue":d[5]||(d[5]=r=>a.value.genero=r),label:"Género",items:p,required:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:o(()=>[e(F,{modelValue:a.value.celular,"onUpdate:modelValue":d[6]||(d[6]=r=>a.value.celular=r),label:"Celular",required:"",type:"number"},null,8,["modelValue"])]),_:1}),e(I,null,{default:o(()=>[Co]),_:1}),e(G),e(v,{cols:"12",md:"6"},{default:o(()=>[e(F,{modelValue:a.value.correo,"onUpdate:modelValue":d[7]||(d[7]=r=>a.value.correo=r),label:"Correo",required:"",type:"email"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:o(()=>[e(F,{modelValue:a.value.contraseña,"onUpdate:modelValue":d[8]||(d[8]=r=>a.value.contraseña=r),label:"Contraseña",required:"",type:C.value?"text":"password","append-icon":"mdi-eye","onClick:append":D},null,8,["modelValue","type"])]),_:1}),e(I,null,{default:o(()=>[Uo]),_:1}),e(G),e(v,{cols:"12",md:"6"},{default:o(()=>[e(T,{modelValue:a.value.rol,"onUpdate:modelValue":d[9]||(d[9]=r=>a.value.rol=r),items:u,label:"Asignacion de Rol",required:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",class:"d-flex flex-wrap gap-4 justify-end"},{default:o(()=>[e(O,{type:"submit",color:"primary",class:"mt-4",disabled:E.value,onClick:we(n,["prevent"])},{default:o(()=>[E.value?(w(),P(L,{key:0},[e(ce,{indeterminate:"",size:"20"}),V(" Guardando... ")],64)):(w(),P(L,{key:1},[V(" Guardar ")],64))]),_:1},8,["disabled","onClick"]),e(O,{color:"secondary",variant:"tonal",type:"reset",class:"mt-4",onClick:q},{default:o(()=>[V(" Resetear ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(G)]),_:1})]),_:1})]),_:1}))}},wo={key:1},Wo={__name:"users-management",setup($){const g=ge(),a=f(g.params.tab);function k(C){let _=C+"=",q=decodeURIComponent(document.cookie).split(";");for(let D=0;D<q.length;D++){let m=q[D];for(;m.charAt(0)==" ";)m=m.substring(1);if(m.indexOf(_)==0)return m.substring(_.length,m.length)}return""}const t=k("rol")=="Gerente",E=[{title:"Lista de Usuarios",icon:"bx-user",tab:"users"},{title:"Usuarios archivados",icon:"bx-archive",tab:"archived"},{title:"Crear Usuario",icon:"bx-user-pin",tab:"create"}];return(C,_)=>(w(),P(L,null,[t?te("",!0):(w(),J(Ee,{key:0})),t?(w(),P("div",wo,[e(he,{modelValue:y(a),"onUpdate:modelValue":_[0]||(_[0]=h=>X(a)?a.value=h:null),"show-arrows":""},{default:o(()=>[(w(),P(L,null,oe(E,h=>e(Ce,{key:h.icon,value:h.tab},{default:o(()=>[e(B,{size:"20",start:"",icon:h.icon},null,8,["icon"]),V(" "+x(h.title),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"]),e(G),e(xe,{modelValue:y(a),"onUpdate:modelValue":_[1]||(_[1]=h=>X(a)?a.value=h:null),class:"mt-5 disable-tab-transition"},{default:o(()=>[e(K,{value:"users"},{default:o(()=>[e(Xe)]),_:1}),e(K,{value:"archived"},{default:o(()=>[e(po)]),_:1}),e(K,{value:"create"},{default:o(()=>[e(ko)]),_:1})]),_:1},8,["modelValue"])])):te("",!0)],64))}};export{Wo as default};
