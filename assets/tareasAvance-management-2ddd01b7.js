import{b as Se}from"./vue-router-38a26824.js";import{f as c,w as ae,aP as ge,o as _,c as $,a as o,bu as ye,bk as he,X as e,bs as a,W as V,F as T,aO as P,J as W,aI as re,aF as de,I as oe,ay as Ce,b1 as L,bx as we,u as ve,i as pe,L as Re}from"./@vue-00b20f2b.js";import{x as X}from"./axios-0b03b3f1.js";import{e as te}from"./index-a67b3544.js";import{a as Le,b as je,l as ne,c as Ve,d as Ne,e as ke}from"./supabase-a2e67656.js";import{_ as ue}from"./@fawmi-f1769799.js";import{a as E,r as p,p as Y,o as G,m as Z,A as me,q as H,C as ee,B as F,I as Ee,d as j,x as Ie,t as se,D as fe,n as _e,E as be,F as Me,v as qe,G as Ge,H as Ae,w as Pe}from"./vuetify-41d014fb.js";import"./@iconify-452d8fcb.js";import"./mitt-f7ef348c.js";import"./@supabase-9ce37a4a.js";import"./pinia-b2002cd0.js";import"./@googlemaps-b4d342ab.js";import"./fast-deep-equal-099ec698.js";import"./apexcharts-clevision-d64c90db.js";import"./supercluster-6504d485.js";import"./kdbush-ac640998.js";import"./pica-f1c996d9.js";const Ue=k=>(re("data-v-25a3ebb6"),k=k(),de(),k),ze=Ue(()=>o("label",{for:"latitude"},"Latitud:",-1)),Be=Ue(()=>o("label",{for:"longitude"},"Longitud:",-1)),Je={__name:"MapSelector",emits:["mapImageCaptured"],setup(k,{emit:C}){const y=c({lat:4.5709,lng:-74.2973}),n=c(7),h=c([]),A=c(null),g=c(null),w=c(null),D=s=>{const i={id:Date.now(),position:s.latLng.toJSON(),lat:s.latLng.lat(),lng:s.latLng.lng()};h.value.push(i)},N=()=>{if(g.value!==null&&w.value!==null){const s={id:Date.now(),position:{lat:parseFloat(g.value),lng:parseFloat(w.value)},lat:parseFloat(g.value),lng:parseFloat(w.value)};h.value.push(s),y.value={lat:parseFloat(g.value),lng:parseFloat(w.value)}}},U=()=>{A.value&&(n.value=A.value.$mapObject.getZoom())},I=async()=>{const s="AIzaSyAHZo9cnmabDRBQAhUbcCfM8E5kaMVt74g",i=`${y.value.lat},${y.value.lng}`,v=n.value,S=h.value.map(M=>`&markers=label:S|${M.position.lat},${M.position.lng}`).join(""),O=`https://maps.googleapis.com/maps/api/staticmap?center=${i}&zoom=${v}&size=600x400&maptype=roadmap${S}&key=${s}`;try{const Q=await(await fetch(O)).blob(),m=URL.createObjectURL(Q),d=new Image;d.src=m,d.onload=()=>{const l=document.createElement("canvas");l.width=d.width,l.height=d.height;const R=l.getContext("2d");R.drawImage(d,0,0),R.fillStyle="rgba(255, 255, 255, 0.8)",R.fillRect(0,0,l.width,50),R.font="16px Arial",R.fillStyle="black",h.value.forEach((ie,B)=>{const{lat:K,lng:ce}=ie.position;R.fillText(`Lat: ${K.toFixed(5)}, Lng: ${ce.toFixed(5)}`,10,20+B*20)});const le=l.toDataURL("image/png"),z=document.createElement("a");z.href=le,z.download="map.png",document.body.appendChild(z),z.click(),document.body.removeChild(z),URL.revokeObjectURL(m),C("mapImageCaptured",{image:le,markers:h.value})}}catch(M){console.error("Error al capturar el mapa:",M)}},x=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{const i=s.coords.latitude,v=s.coords.longitude;g.value=i,w.value=v,y.value={lat:i,lng:v};const S={id:Date.now(),position:{lat:i,lng:v},lat:i,lng:v};h.value.push(S)},s=>{console.error("Error obteniendo la ubicación: ",s)}):alert("La geolocalización no es soportada por este navegador.")},b=s=>{h.value=h.value.filter(i=>i.id!==s)};return ae(n,s=>{A.value&&A.value.$mapObject.setZoom(s)}),(s,i)=>{const v=ge("GMapMarker"),S=ge("GMapMap");return _(),$("div",null,[o("div",null,[ze,ye(o("input",{"onUpdate:modelValue":i[0]||(i[0]=O=>g.value=O),id:"latitude",type:"number",placeholder:"Latitud",step:"any"},null,512),[[he,g.value]]),Be,ye(o("input",{"onUpdate:modelValue":i[1]||(i[1]=O=>w.value=O),id:"longitude",type:"number",placeholder:"Longitud",step:"any"},null,512),[[he,w.value]]),e(E,{onClick:N},{default:a(()=>[V("Agregar Marcador")]),_:1}),e(E,{onClick:x},{default:a(()=>[V("Obtener Mi Ubicación")]),_:1})]),e(S,{ref_key:"mapRef",ref:A,center:y.value,zoom:n.value,style:{width:"100%",height:"500px"},onClick:D,onZoom_changed:U},{default:a(()=>[(_(!0),$(T,null,P(h.value,O=>(_(),W(v,{key:O.id,position:O.position,onRightclick:M=>b(O.id)},null,8,["position","onRightclick"]))),128))]),_:1},8,["center","zoom"]),e(E,{onClick:I},{default:a(()=>[V("Capturar Imagen del Mapa")]),_:1})])}}},Ze=ue(Je,[["__scopeId","data-v-25a3ebb6"]]),We=o("p",{class:"text-body-1 mb-0"}," Completa los siguientes campos para añadir un avance en la tarea de la obra ",-1),Ke=o("p",{class:"text-body-1 mb-0"}," ¿Se propone para revisión (entrega de la tarea finalizada)? ",-1),He=o("p",{class:"text-body-1 mb-0"}," Necesidades para continuar con la tarea: ",-1),Qe=o("p",{class:"text-body-1 mb-0"}," Audios de avance tarea ",-1),Xe={class:"d-flex flex-column justify-center gap-5"},Ye={class:"d-flex flex-wrap gap-2"},ea=o("span",{class:"d-none d-sm-block"},"Upload new audios",-1),aa=o("span",{class:"d-none d-sm-block"},"Reset",-1),la=["src"],ta=o("p",{class:"text-body-1 mb-0"}," Allowed MP3, WAV or OGG. Max size of 800K each ",-1),oa=o("p",{class:"text-body-1 mb-0"}," Fotos de avance tarea ",-1),na={class:"d-flex flex-column justify-center gap-5"},sa={class:"d-flex flex-wrap gap-2"},ra=o("span",{class:"d-none d-sm-block"},"Upload new images",-1),da=o("span",{class:"d-none d-sm-block"},"Reset",-1),ua={style:{"max-height":"400px","overflow-y":"auto"}},ia=["src"],ca=o("p",{class:"text-body-1 mb-0"}," Allowed JPG, JPEG, PNG, or GIF. Max size of 800K each ",-1),va={__name:"AvancesCreate",setup(k){const C=c(null),y=c(),n=c({}),h=c([]),A=u=>{const r=u.target.files;n.value=Array.from(r),h.value=[],r.length?Array.from(r).forEach(t=>{const f=new FileReader;f.readAsDataURL(t),f.onload=()=>{typeof f.result=="string"&&(h.value.push({name:t.name,url:f.result,file:t}),console.log(`Archivo seleccionado: ${t.name}`))}}):console.log("No se han seleccionado archivos de audio.")},g=async(u,r)=>{const t=[];for(let f=0;f<u.length;f++){const J=u[f].file;try{const q=await Le(J,r);t.push({id:r,url:q})}catch(q){console.error("Error uploading file:",q)}}return t},w=()=>{h.value=[],y.value.value=""},D=c(),N=c({}),U=c([]),I=u=>{const r=u.target.files;N.value=Array.from(r),U.value=[],r.length?Array.from(r).forEach(t=>{const f=new FileReader;f.readAsDataURL(t),f.onload=()=>{typeof f.result=="string"&&(U.value.push({name:t.name,url:f.result,file:t}),console.log(`Archivo seleccionado: ${t.name}`))}}):console.log("No se han seleccionado archivos de imagen.")},x=async(u,r)=>{const t=[];for(let f=0;f<u.length;f++){const J=u[f].file;try{const q=await je(J,r);t.push({id:r,url:q})}catch(q){console.error("Error uploading file:",q)}}return t},b=()=>{U.value=[],D.value.value=""},s=c([]),i=c({}),v=c([]),S=c({}),O=c([]),M=async()=>{try{const r=(await X.get("http://desarrollo-constructora-back.onrender.com/constructora/v1/Obra/")).data;s.value=r.filter(t=>t.activo).map(t=>{const f=`${t.obraid} - ${t.nombre}`;return i.value[f]=t.obraid,{obraid:t.obraid,nombre:t.nombre,tipodeobra:t.tipodeobra,estado:t.estado,displayText:f}})}catch(u){console.error("Error al obtener las obras:",u)}},Q=oe(()=>s.value.map(u=>u.displayText));oe(()=>v.value.map(u=>u.displayText));const m=async()=>{try{const r=(await X.get("http://desarrollo-constructora-back.onrender.com/constructora/v1/Tarea/")).data;v.value=r.filter(t=>t.activo).map(t=>{const f=`${t.tareaid} - ${t.estado} - ${t.tipodetarea}`;return S.value[f]=t.tareaid,{tareaid:t.tareaid,obraid:t.obraid,tipodetarea:t.tipodetarea,descripcion:t.descripcion,fechaasignacion:t.fechaasignacion,fechaestimada:t.fechaestimada,estado:t.estado,activo:t.activo,displayText:f}})}catch(u){console.error("Error al obtener las tareas:",u)}},d={tareaid:"Selecciona Tarea",obraid:"Selecciona Obra",descripcion:"",porcentajeavance:"",revision:!1,necesidades:"Selecciona",estado:"",audioUrls:[]},l=c(structuredClone(d)),R=c(!1),le=["Materiales","Asignar más personal","Cambio de condiciones climáticas","Ninguna"],z=async()=>{R.value=!0;try{const u=i.value[l.value.obraid],r=S.value[l.value.tareaid],t={obraid:u,tareaid:r,estado:l.value.estado,porcentajeavance:l.value.porcentajeavance,descripcion:l.value.descripcion,revision:l.value.revision,necesidades:l.value.necesidades},J=(await X.post("http://desarrollo-constructora-back.onrender.com/constructora/v1/Tarea_Obra/",t)).data.tareaid;if(h.value.length>0){const q=await g(h.value,J);console.log("Audios subidos:",q)}if(U.value.length>0){const q=await x(U.value,J);console.log("Imágenes subidas:",q)}return console.log("Avance de tarea creada  con éxito, ID:",J),Te(),J}catch(u){console.error("Error al crear Avance de tarea:",u)}finally{R.value=!1}},ie=[u=>u===""||u>=1&&u<=99||"El porcentaje debe estar entre 1% y 99%"],B=c(!1),K=c(!1);ae(()=>l.value.obraid,u=>{if(u&&u!=="Selecciona Obra"){const r=i.value[u];O.value=v.value.filter(t=>t.obraid===r),l.value.tareaid="Selecciona Tarea"}else O.value=[],l.value.tareaid="Selecciona Tarea"}),ae(()=>l.value.tareaid,u=>{const r=v.value.find(t=>t.displayText===u);r?(l.value.estado=r.estado,console.log("Estado de la tarea seleccionada:",r.estado),ce(r.estado)):console.log("No se encontró la tarea seleccionada")});const ce=u=>{switch(u){case"Asignada":l.value.porcentajeavance=0,l.value.revision=!1,K.value=!1,B.value=!0;break;case"En desarrollo":l.value.porcentajeavance=1,l.value.revision=!1,K.value=!1,B.value=!1;break;case"En revision":l.value.porcentajeavance=100,l.value.revision=!0,l.value.necesidades="Ninguna",K.value=!0,B.value=!0;break;case"Aceptada":l.value.porcentajeavance=100,B.value=!0,l.value.revision=!1,K.value=!0,l.value.necesidades="Ninguna";break}console.log("Porcentaje de avance actualizado:",l.value.porcentajeavance)},Fe=oe(()=>O.value.map(u=>u.displayText));Ce(()=>{M(),m()});const Te=()=>{l.value=structuredClone(d),w(),b()};return(u,r)=>(_(),W(H,{justify:"center"},{default:a(()=>[e(p,{cols:"12",md:"8"},{default:a(()=>[e(Y,{title:"Crear Avance de Tarea"},{default:a(()=>[e(G,null,{default:a(()=>[We]),_:1}),e(Z),e(G,null,{default:a(()=>[e(me,{ref_key:"form",ref:C,class:"mt-6"},{default:a(()=>[e(H,null,{default:a(()=>[e(p,{cols:"12",md:"6"},{default:a(()=>[e(ee,{modelValue:l.value.obraid,"onUpdate:modelValue":r[0]||(r[0]=t=>l.value.obraid=t),items:Q.value,label:"ID OBRA",required:""},null,8,["modelValue","items"])]),_:1}),e(p,{cols:"12",md:"6"},{default:a(()=>[e(ee,{modelValue:l.value.tareaid,"onUpdate:modelValue":r[1]||(r[1]=t=>l.value.tareaid=t),items:Fe.value,label:"ID TAREA",required:"",type:"text"},null,8,["modelValue","items"])]),_:1}),e(p,{cols:"12",md:"6"},{default:a(()=>[e(F,{modelValue:l.value.estado,"onUpdate:modelValue":r[2]||(r[2]=t=>l.value.estado=t),label:"Estado de la Tarea",required:"",readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"2"},{default:a(()=>[e(F,{modelValue:l.value.porcentajeavance,"onUpdate:modelValue":r[3]||(r[3]=t=>l.value.porcentajeavance=t),label:"Avance %",required:"",type:B.value?"text":"number",disabled:B.value,rules:ie,suffix:"%"},null,8,["modelValue","type","disabled"])]),_:1}),e(p,{cols:"12",md:"12"},{default:a(()=>[e(F,{modelValue:l.value.descripcion,"onUpdate:modelValue":r[4]||(r[4]=t=>l.value.descripcion=t),label:"Descripción de Avance",required:"",type:"text"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:a(()=>[e(G,null,{default:a(()=>[Ke]),_:1})]),_:1}),e(p,{cols:"12",md:"4"},{default:a(()=>[e(Ee,{modelValue:l.value.revision,"onUpdate:modelValue":r[5]||(r[5]=t=>l.value.revision=t),label:`Revisión: ${l.value.revision?"Si":"No"}`,"false-value":u.No,readonly:"",required:""},null,8,["modelValue","label","false-value"])]),_:1}),e(p,{cols:"12",md:"6"},{default:a(()=>[e(G,null,{default:a(()=>[He]),_:1})]),_:1}),e(p,{cols:"12",md:"3"},{default:a(()=>[e(ee,{modelValue:l.value.necesidades,"onUpdate:modelValue":r[6]||(r[6]=t=>l.value.necesidades=t),label:"",items:le,disabled:K.value,required:""},null,8,["modelValue","disabled"])]),_:1}),e(Z),e(G,null,{default:a(()=>[Qe]),_:1}),e(Z),e(p,null,{default:a(()=>[o("form",Xe,[o("div",Ye,[e(E,{color:"primary",onClick:r[7]||(r[7]=t=>{var f;return(f=y.value)==null?void 0:f.click()})},{default:a(()=>[e(j,{icon:"bx-cloud-upload",class:"d-sm-none"}),ea]),_:1}),o("input",{ref_key:"refInputEl",ref:y,type:"file",name:"file",accept:".mp3,.wav,.ogg",hidden:"",onChange:A,multiple:""},null,544),e(E,{type:"reset",color:"error",variant:"tonal",onClick:w},{default:a(()=>[aa,e(j,{icon:"bx-refresh",class:"d-sm-none"})]),_:1})]),o("ul",null,[(_(!0),$(T,null,P(h.value,(t,f)=>(_(),$("li",{key:f},[V(L(t.name)+" ",1),o("audio",{src:t.url,controls:""},null,8,la)]))),128))]),ta])]),_:1}),e(Z),e(G,null,{default:a(()=>[oa]),_:1}),e(Z),e(p,{cols:"12",md:"12"},{default:a(()=>[e(Ze,{onImageCaptured:u.handleImageCaptured},null,8,["onImageCaptured"])]),_:1}),e(Z),e(p,null,{default:a(()=>[o("form",na,[o("div",sa,[e(E,{color:"primary",onClick:r[8]||(r[8]=t=>{var f;return(f=D.value)==null?void 0:f.click()})},{default:a(()=>[e(j,{icon:"bx-cloud-upload",class:"d-sm-none"}),ra]),_:1}),o("input",{ref_key:"refImageInputEl",ref:D,type:"file",name:"file",accept:".jpg,.jpeg,.png,.gif",hidden:"",onChange:I,multiple:""},null,544),e(E,{type:"reset",color:"error",variant:"tonal",onClick:b},{default:a(()=>[da,e(j,{icon:"bx-refresh",class:"d-sm-none"})]),_:1})]),o("div",ua,[o("ul",null,[(_(!0),$(T,null,P(U.value,(t,f)=>(_(),$("li",{key:f},[V(L(t.name)+" ",1),o("img",{src:t.url,alt:"Uploaded Image",style:{"max-width":"100%",height:"auto"}},null,8,ia)]))),128))])]),ca])]),_:1}),e(p,{cols:"12",class:"d-flex flex-wrap gap-4 justify-end"},{default:a(()=>[e(E,{type:"submit",color:"primary",class:"mt-4",disabled:R.value,onClick:we(z,["prevent"])},{default:a(()=>[R.value?(_(),$(T,{key:0},[e(Ie,{indeterminate:"",size:"20"}),V(" Guardando... ")],64)):(_(),$(T,{key:1},[V(" Guardar ")],64))]),_:1},8,["disabled","onClick"]),e(E,{color:"secondary",variant:"tonal",type:"reset",class:"mt-4",onClick:z},{default:a(()=>[V(" Resetear ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1}),e(Z)]),_:1})]),_:1})]),_:1}))}};const Oe=k=>(re("data-v-edbb9c60"),k=k(),de(),k),pa=Oe(()=>o("h3",null,"Archivos de Audio",-1)),ma=["href"],fa=Oe(()=>o("h3",null,"Imágenes",-1)),_a=["href"],xe="https://yrmvpuhcbcgqqvvbvkcg.supabase.co",ba={__name:"EditAvanceForm",props:{isOpen:Boolean,avance:Object},emits:["update:isOpen","save"],setup(k,{emit:C}){const y=k,n=c(JSON.parse(JSON.stringify(y.avance))),h=c([]),A=c([]),g=c([]),w=c([]),D=c(!1);ae(()=>y.avance,m=>{n.value=JSON.parse(JSON.stringify(m)),n.value.tareaid&&N(n.value.tareaid)},{deep:!0,immediate:!0});const N=async m=>{try{h.value=await ne(m,"audio_avance"),A.value=await ne(m,"images")}catch(d){console.error("Error fetching files:",d)}},U=m=>`${xe}/storage/v1/object/public/audio_avance/${n.value.tareaid}/${m}`,I=m=>`${xe}/storage/v1/object/public/images/${n.value.tareaid}/${m}`,x=[{name:"Asignada",value:"ASIGNADA"},{name:"En desarrollo",value:"EN_DESARROLLO"},{name:"En revisión",value:"EN_REVISION"},{name:"Aceptada",value:"ACEPTADA"}],b=[m=>m===""||m>=0&&m<=100||"El porcentaje debe estar entre 0% y 100%"],s=["Materiales","Asignar más personal","Cambio de condiciones climáticas","Ninguna"],i=async()=>{D.value=!0;try{const m=n.value.tareaid,d=await X.patch(`http://desarrollo-constructora-back.onrender.com/constructora/v1/Tarea_Obra/${m}/update-by-tareaid/`,n.value);await v(),C("save",d.data),C("update:isOpen",!1)}catch(m){console.error("Error updating advance:",m)}finally{D.value=!1}},v=async()=>{try{const m=n.value.tareaid;for(const d of g.value)await Ve(m,"audio_avance",d);for(const d of w.value)await Ve(m,"images",d);N(m)}catch(m){console.error("Error uploading files:",m)}},S=()=>{C("update:isOpen",!1)},O=m=>{C("update:isOpen",m)},M=(m,d)=>{const l=Array.from(m.target.files);d==="audio_avance"?g.value=l:d==="images"&&(w.value=l)},Q=async(m,d)=>{try{await Ne(n.value.tareaid,d,m),N(n.value.tareaid)}catch(l){console.error("Error deleting file:",l)}};return(m,d)=>(_(),W(be,{"model-value":k.isOpen,"onUpdate:modelValue":O,"max-width":"600px"},{default:a(()=>[e(Y,null,{default:a(()=>[e(se,{class:"headline"},{default:a(()=>[V(" Editar Avance ")]),_:1}),e(G,null,{default:a(()=>[e(me,{ref:"form"},{default:a(()=>[e(H,null,{default:a(()=>[e(p,{cols:"12",md:6},{default:a(()=>[e(F,{modelValue:n.value.obraid,"onUpdate:modelValue":d[0]||(d[0]=l=>n.value.obraid=l),label:"ID OBRA",required:"",readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:6},{default:a(()=>[e(F,{modelValue:n.value.tareaid,"onUpdate:modelValue":d[1]||(d[1]=l=>n.value.tareaid=l),label:"ID TAREA",required:"",readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:12},{default:a(()=>[e(F,{modelValue:n.value.descripcion,"onUpdate:modelValue":d[2]||(d[2]=l=>n.value.descripcion=l),label:"Descripción de Avance",required:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:6},{default:a(()=>[e(ee,{modelValue:n.value.estado,"onUpdate:modelValue":d[3]||(d[3]=l=>n.value.estado=l),items:x,label:"Estado de la Tarea",required:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:6},{default:a(()=>[e(F,{modelValue:n.value.porcentajeavance,"onUpdate:modelValue":d[4]||(d[4]=l=>n.value.porcentajeavance=l),label:"Avance %",required:"",type:"number",rules:b,suffix:"%"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:6},{default:a(()=>[e(Ee,{modelValue:n.value.revision,"onUpdate:modelValue":d[5]||(d[5]=l=>n.value.revision=l),label:`Revisión: ${n.value.revision?"Sí":"No"}`},null,8,["modelValue","label"])]),_:1}),e(p,{cols:"12",md:6},{default:a(()=>[e(ee,{modelValue:n.value.necesidades,"onUpdate:modelValue":d[6]||(d[6]=l=>n.value.necesidades=l),items:s,label:"Necesidades"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:12},{default:a(()=>[pa,o("ul",null,[(_(!0),$(T,null,P(h.value,l=>(_(),$("li",{key:l.name},[o("a",{href:U(l.name),target:"_blank"},L(l.name),9,ma),e(E,{icon:"",onClick:R=>Q(l.name,"audio_avance")},{default:a(()=>[e(j,null,{default:a(()=>[V("mdi-delete")]),_:1})]),_:2},1032,["onClick"])]))),128))]),o("input",{type:"file",onChange:d[7]||(d[7]=l=>M(l,"audio_avance")),multiple:""},null,32)]),_:1}),e(p,{cols:"12",md:12},{default:a(()=>[fa,o("ul",null,[(_(!0),$(T,null,P(A.value,l=>(_(),$("li",{key:l.name},[o("a",{href:I(l.name),target:"_blank"},L(l.name),9,_a),e(E,{icon:"",onClick:R=>Q(l.name,"images")},{default:a(()=>[e(j,null,{default:a(()=>[V("mdi-delete")]),_:1})]),_:2},1032,["onClick"])]))),128))]),o("input",{type:"file",onChange:d[8]||(d[8]=l=>M(l,"images")),multiple:""},null,32)]),_:1})]),_:1})]),_:1},512)]),_:1}),e(fe,null,{default:a(()=>[e(_e),e(E,{color:"blue darken-1",text:"",class:"mt-4",onClick:S},{default:a(()=>[V(" Cancelar ")]),_:1}),e(E,{type:"submit",color:"primary",class:"mt-4",disabled:D.value,onClick:we(i,["prevent"])},{default:a(()=>[D.value?(_(),$(T,{key:0},[e(Ie,{indeterminate:"",size:"20"}),V(" Guardando... ")],64)):(_(),$(T,{key:1},[V(" Guardar ")],64))]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}},ga=ue(ba,[["__scopeId","data-v-edbb9c60"]]);const De=k=>(re("data-v-ca364804"),k=k(),de(),k),ya=De(()=>o("h3",null,"Archivos de Audio",-1)),ha=["href"],Va=De(()=>o("h3",null,"Imágenes",-1)),ka=["href"],$e="https://yrmvpuhcbcgqqvvbvkcg.supabase.co",Aa={__name:"ShowDetailsAvancesForm",props:{avance:Object,isOpen:Boolean},emits:["update:isOpen"],setup(k,{emit:C}){const y=k,n=c({}),h=c([]),A=c([]),g=oe(()=>n.value.revision?"Sí":"No");ae(()=>y.avance,I=>{n.value={...I},n.value.tareaid&&w(n.value.tareaid)},{immediate:!0});const w=async I=>{try{h.value=await ne(I,"audio_avance"),A.value=await ne(I,"images")}catch(x){console.error("Error fetching files:",x)}},D=I=>`${$e}/storage/v1/object/public/audio_avance/${n.value.tareaid}/${I}`,N=I=>`${$e}/storage/v1/object/public/images/${n.value.tareaid}/${I}`,U=()=>{C("update:isOpen",!1)};return(I,x)=>(_(),W(be,{"model-value":k.isOpen,"onUpdate:modelValue":U},{default:a(()=>[e(H,{justify:"center"},{default:a(()=>[e(p,{cols:"12",md:"8"},{default:a(()=>[e(Y,null,{default:a(()=>[e(se,{class:"headline"},{default:a(()=>[V(" Detalles del Avance ")]),_:1}),e(G,null,{default:a(()=>[n.value?(_(),W(me,{key:0},{default:a(()=>[e(H,null,{default:a(()=>[e(p,{cols:"12",md:"6"},{default:a(()=>[e(F,{modelValue:n.value.obraid,"onUpdate:modelValue":x[0]||(x[0]=b=>n.value.obraid=b),label:"ID de la Obra",readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:a(()=>[e(F,{modelValue:n.value.tareaid,"onUpdate:modelValue":x[1]||(x[1]=b=>n.value.tareaid=b),label:"ID de la Tarea",readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12"},{default:a(()=>[e(F,{modelValue:n.value.descripcion,"onUpdate:modelValue":x[2]||(x[2]=b=>n.value.descripcion=b),label:"Descripción de Avance",readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:a(()=>[e(F,{modelValue:n.value.estado,"onUpdate:modelValue":x[3]||(x[3]=b=>n.value.estado=b),label:"Estado de la Tarea",readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:a(()=>[e(F,{modelValue:n.value.porcentajeavance,"onUpdate:modelValue":x[4]||(x[4]=b=>n.value.porcentajeavance=b),label:"Avance %",readonly:"",suffix:"%"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:a(()=>[e(F,{modelValue:ve(g),"onUpdate:modelValue":x[5]||(x[5]=b=>pe(g)?g.value=b:null),label:"Revisión",readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"6"},{default:a(()=>[e(F,{modelValue:n.value.necesidades,"onUpdate:modelValue":x[6]||(x[6]=b=>n.value.necesidades=b),label:"Necesidades",readonly:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12"},{default:a(()=>[ya,o("ul",null,[(_(!0),$(T,null,P(h.value,b=>(_(),$("li",{key:b.name},[o("a",{href:D(b.name),target:"_blank",rel:"noopener noreferrer"},L(b.name),9,ha)]))),128))])]),_:1}),e(p,{cols:"12"},{default:a(()=>[Va,o("ul",null,[(_(!0),$(T,null,P(A.value,b=>(_(),$("li",{key:b.name},[o("a",{href:N(b.name),target:"_blank",rel:"noopener noreferrer"},L(b.name),9,ka)]))),128))])]),_:1})]),_:1})]),_:1})):Re("",!0)]),_:1}),e(fe,null,{default:a(()=>[e(_e),e(E,{color:"blue darken-1",onClick:U},{default:a(()=>[V(" Cerrar ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},xa=ue(Aa,[["__scopeId","data-v-ca364804"]]);const $a=k=>(re("data-v-a9ee9e59"),k=k(),de(),k),Ca=$a(()=>o("thead",null,[o("tr",null,[o("th",{class:"text-uppercase"},"ID obraid"),o("th",{class:"text-uppercase"},"ID Tarea"),o("th",null,"Descripción"),o("th",null,"Estado"),o("th",null,"Porcentaje de Avance"),o("th",null,"Revisión"),o("th",null,"Acciones")])],-1)),wa={class:"text-center"},Ea={class:"text-center"},Ia={class:"text-center"},Ua={class:"text-center"},Oa={class:"text-center"},Da={__name:"EditableAvancesList",setup(k){const C=c([]),y=c({}),n=c(!1),h=c(!1),A=c(!1),g=c(null),w=async()=>{try{const s=await X.get("http://desarrollo-constructora-back.onrender.com/constructora/v1/Tarea_Obra/");C.value=s.data}catch(s){console.error("Error al obtener los avances:",s)}},D=s=>({ASIGNADA:"Asignada",EN_DESARROLLO:"En desarrollo",EN_REVISION:"En revisión",ACEPTADA:"Aceptada"})[s]||s,N=s=>{y.value={...s},h.value=!0},U=s=>{y.value={...s},n.value=!0},I=s=>{const i=C.value.findIndex(v=>v.tareaid===s.tareaid);i!==-1&&(C.value[i]={...s})},x=s=>{g.value=s,A.value=!0},b=async()=>{try{const s=g.value;await ke(s.tareaid,"audio_avance"),await ke(s.tareaid,"images"),await X.delete(`http://desarrollo-constructora-back.onrender.com/constructora/v1/Tarea_Obra/${s.tareaid}/delete-by-tareaid/`),C.value=C.value.filter(i=>i.tareaid!==s.tareaid),console.log(`Avance ${s.tareaid} eliminado con éxito`),te.emit("avance-deleted")}catch(s){s.response&&s.response.status===404?(console.warn(`No se encontraron archivos para la tarea ${avance.tareaid}, pero se eliminará el registro de todas formas.`),C.value=C.value.filter(i=>i.tareaid!==avance.tareaid),te.emit("avance-deleted")):console.error("Error al eliminar el avance:",s)}finally{A.value=!1}};return Ce(()=>{w(),te.on("avance-created",w),te.on("avance-updated",w)}),(s,i)=>(_(),$(T,null,[e(H,null,{default:a(()=>[e(p,{cols:"12"},{default:a(()=>[e(Y,null,{default:a(()=>[e(se,null,{default:a(()=>[V(" Lista de Avances de Tareas ")]),_:1}),e(G,null,{default:a(()=>[e(Me,null,{default:a(()=>[Ca,o("tbody",null,[(_(!0),$(T,null,P(C.value,v=>(_(),$("tr",{key:v.obraid},[o("td",null,L(v.obraid),1),o("td",null,L(v.tareaid),1),o("td",wa,L(v.descripcion),1),o("td",Ea,L(D(v.estado)),1),o("td",Ia,L(v.porcentajeavance)+"%",1),o("td",Ua,[v.revision?(_(),W(j,{key:0,color:"green"},{default:a(()=>[V("mdi-check-circle")]),_:1})):(_(),W(j,{key:1,color:"red"},{default:a(()=>[V("mdi-close-circle")]),_:1}))]),o("td",Oa,[e(E,{icon:"",style:{marginLeft:"0.5rem"},onClick:S=>N(v)},{default:a(()=>[e(j,null,{default:a(()=>[V("mdi-eye")]),_:1})]),_:2},1032,["onClick"]),e(E,{icon:"",style:{marginLeft:"0.5rem",marginRight:"0.5rem"},onClick:S=>U(v)},{default:a(()=>[e(j,null,{default:a(()=>[V("mdi-pencil")]),_:1})]),_:2},1032,["onClick"]),e(E,{icon:"",style:{marginLeft:"0.5rem"},color:"error",onClick:S=>x(v)},{default:a(()=>[e(j,null,{default:a(()=>[V("mdi-delete")]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ga,{isOpen:n.value,"onUpdate:isOpen":i[0]||(i[0]=v=>n.value=v),avance:y.value,onSave:I},null,8,["isOpen","avance"]),e(xa,{isOpen:h.value,"onUpdate:isOpen":i[1]||(i[1]=v=>h.value=v),avance:y.value},null,8,["isOpen","avance"]),e(be,{modelValue:A.value,"onUpdate:modelValue":i[3]||(i[3]=v=>A.value=v),"max-width":"500px"},{default:a(()=>[e(Y,null,{default:a(()=>[e(se,{class:"headline"},{default:a(()=>[V("Confirmar Eliminación")]),_:1}),e(G,null,{default:a(()=>[V("¿Estás seguro de que deseas eliminar este avance?")]),_:1}),e(fe,null,{default:a(()=>[e(_e),e(E,{color:"blue darken-1",text:"",onClick:i[2]||(i[2]=v=>A.value=!1)},{default:a(()=>[V("Cancelar")]),_:1}),e(E,{color:"blue darken-1",text:"",onClick:b},{default:a(()=>[V("Confirmar")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Fa=ue(Da,[["__scopeId","data-v-a9ee9e59"]]),Ta=o("code",null,"Avances ",-1),Sa={__name:"AvancesList",setup(k){return(C,y)=>(_(),W(H,null,{default:a(()=>[e(p,{cols:"12"},{default:a(()=>[e(Y,{title:"Avances"},{default:a(()=>[e(G,null,{default:a(()=>[Ta]),_:1}),e(Fa)]),_:1})]),_:1})]),_:1}))}},Ya={__name:"tareasAvance-management",setup(k){const C=Se(),y=c(C.params.tab),n=[{title:"Lista de Avances",icon:"bx-user",tab:"avances"},{title:"Crear Avances",icon:"bx-user-pin",tab:"create"}];return(h,A)=>(_(),$("div",null,[e(qe,{modelValue:ve(y),"onUpdate:modelValue":A[0]||(A[0]=g=>pe(y)?y.value=g:null),"show-arrows":""},{default:a(()=>[(_(),$(T,null,P(n,g=>e(Pe,{key:g.icon,value:g.tab},{default:a(()=>[e(j,{size:"20",start:"",icon:g.icon},null,8,["icon"]),V(" "+L(g.title),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"]),e(Z),e(Ge,{modelValue:ve(y),"onUpdate:modelValue":A[1]||(A[1]=g=>pe(y)?y.value=g:null),class:"mt-5 disable-tab-transition"},{default:a(()=>[e(Ae,{value:"avances"},{default:a(()=>[e(Sa)]),_:1}),e(Ae,{value:"create"},{default:a(()=>[e(va)]),_:1})]),_:1},8,["modelValue"])]))}};export{Ya as default};
