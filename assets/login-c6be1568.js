import{f as m,at as D,o as v,c as b,X as l,bs as s,a as p,u as T,W as x,L as w,b1 as U,bx as j}from"./@vue-00b20f2b.js";import{l as A}from"./logo-10e22896.js";import{x as g}from"./axios-0b03b3f1.js";import{u as E}from"./vue-router-38a26824.js";import{e as O}from"./index-a67b3544.js";import{g as R}from"./supabase-a2e67656.js";import{p as I,s as P,t as M,o as V,A as N,q as z,r as k,B as y,J as L,a as S}from"./vuetify-41d014fb.js";import"./@iconify-452d8fcb.js";import"./mitt-f7ef348c.js";import"./@supabase-9ce37a4a.js";import"./pinia-b2002cd0.js";import"./@fawmi-f1769799.js";import"./@googlemaps-b4d342ab.js";import"./fast-deep-equal-099ec698.js";import"./apexcharts-clevision-d64c90db.js";import"./supercluster-6504d485.js";import"./kdbush-ac640998.js";import"./pica-f1c996d9.js";const F={class:"auth-wrapper d-flex align-center justify-center pa-4"},H={class:"d-flex"},$=["innerHTML"],q=p("h5",{class:"text-h5 mb-1"}," Bienvenido al portal de Bcorp! ",-1),G={key:0,class:"mb-0"},J={key:1,class:"mb-0",style:{color:"darkred"}},W={class:"d-flex align-center justify-space-between flex-wrap mt-1 mb-4"},fe={__name:"login",setup(X){const a=m({email:"",password:"",remember:!1}),c=m(!1),_=m([]),i=m(""),C=async()=>{try{const t=[{role:"Director de Obra",url:"http://desarrollo-constructora-back.onrender.com/constructora/v1/DirectorDeObra/"},{role:"Capataz",url:"http://desarrollo-constructora-back.onrender.com/constructora/v1/Capataz/"},{role:"Ayudante de Obra",url:"http://desarrollo-constructora-back.onrender.com/constructora/v1/AyudanteDeObra/"},{role:"Peon",url:"http://desarrollo-constructora-back.onrender.com/constructora/v1/Peon/"}],e=await Promise.all(t.map(o=>g.get(o.url))),r={};return e.forEach((o,n)=>{const d=t[n].role;o.data.forEach(f=>{r[f.numerodeid]||(r[f.numerodeid]=[]),r[f.numerodeid].push(d)})}),r}catch(t){return console.error("Error al obtener los roles de los usuarios:",t),{}}},h=async()=>{try{const e=(await g.get("http://desarrollo-constructora-back.onrender.com/constructora/v1/Usuario/")).data,r=await C();_.value=e.filter(o=>o.activo).map(o=>({numerodeid:o.numerodeid,nombres:o.nombres,apellidos:o.apellidos,tipodeid:o.tipodeid,celular:o.celular,genero:o.genero,contraseña:o.contraseña,correo:o.correo,activo:o.activo,rol:r[o.numerodeid]?r[o.numerodeid].join(", "):"Gerente"})).filter(o=>o.rol!="Peon"&&o.rol!="Ayudante de Obra")}catch(t){console.error("Error al obtener los usuarios:",t)}};function u(t){let e=t+"=",o=decodeURIComponent(document.cookie).split(";");for(let n=0;n<o.length;n++){let d=o[n];for(;d.charAt(0)==" ";)d=d.substring(1);if(d.indexOf(e)==0)return d.substring(e.length,d.length)}return""}D(()=>{u("user")!=""&&E().push("/dashboard"),h(),O.on("usuarios",h),u("email")!=""&&(a.value.email=u("email"),a.value.password=u("password"),a.value.remember=!0)});function B(){let t=-1;const e=_.value;for(let r in e){let o=r;r=e[r],r.correo===a.value.email&&r.contraseña===a.value.password&&(t=o)}if(t==-1)i.value="usuario o contraseña incorrecto",a.value.email="",a.value.password="",window.setTimeout(()=>{i.value=""},3e3);else{if(document.cookie="id="+e[t].numerodeid,document.cookie="user="+e[t].nombres,document.cookie="rol="+e[t].rol,document.cookie="avatar="+R(e[t].numerodeid),a.value.remember){const r=new Date,n=new Date(r.setDate(r.getDate()+1)).toUTCString();document.cookie="password = "+e[t].contraseña+"; expires = "+n,document.cookie="email = "+e[t].correo+";expires = "+n}location.reload()}}return(t,e)=>(v(),b("div",F,[l(I,{class:"auth-card pa-4 pt-7","max-width":"448"},{default:s(()=>[l(P,{class:"justify-center"},{prepend:s(()=>[p("div",H,[p("div",{class:"d-flex text-primary",innerHTML:T(A)},null,8,$)])]),default:s(()=>[l(M,{class:"text-2xl font-weight-bold"},{default:s(()=>[x(" Bcorp ")]),_:1})]),_:1}),l(V,{class:"pt-2"},{default:s(()=>[q,i.value==""?(v(),b("p",G," Ingresa para empezar a trabajar ")):w("",!0),i.value!=""?(v(),b("p",J,U(i.value),1)):w("",!0)]),_:1}),l(V,null,{default:s(()=>[l(N,{onSubmit:e[4]||(e[4]=j(r=>B(),["prevent"]))},{default:s(()=>[l(z,null,{default:s(()=>[l(k,{cols:"12"},{default:s(()=>[l(y,{modelValue:a.value.email,"onUpdate:modelValue":e[0]||(e[0]=r=>a.value.email=r),autofocus:"",placeholder:"johndoe@email.com",label:"Correo",type:"email"},null,8,["modelValue"])]),_:1}),l(k,{cols:"12"},{default:s(()=>[l(y,{modelValue:a.value.password,"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.password=r),label:"Contraseña",placeholder:"············",type:c.value?"text":"password","append-inner-icon":c.value?"bx-hide":"bx-show","onClick:appendInner":e[2]||(e[2]=r=>c.value=!c.value)},null,8,["modelValue","type","append-inner-icon"]),p("div",W,[l(L,{modelValue:a.value.remember,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.remember=r),label:"Recordarme por 90 dias"},null,8,["modelValue"])]),l(S,{block:"",type:"submit"},{default:s(()=>[x(" Ingresar ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]))}};export{fe as default};
