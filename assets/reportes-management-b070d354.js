import{b as re}from"./vue-router-38a26824.js";import{x as g}from"./axios-0b03b3f1.js";import{e as L}from"./index-a67b3544.js";import{f as z,h as se,i as k}from"./supabase-a2e67656.js";import{C as le}from"./chart.js-093af93b.js";import{_ as G}from"./@fawmi-f1769799.js";import{f as w,ay as Q,w as W,o as n,c as v,a as p,I as M,J as S,bs as t,F as C,aO as J,b1 as F,X as e,W as x,L as A,aI as Y,aF as Z,bx as ne,u as H,i as X}from"./@vue-00b20f2b.js";import{F as ee,q as $,r as V,p as E,t as q,o as N,A as te,B as j,n as B,D as ae,a as T,E as oe,d as I,m as P,C as U,x as de,v as ce,G as ie,H as K,w as ue}from"./vuetify-41d014fb.js";import"./@iconify-452d8fcb.js";import"./mitt-f7ef348c.js";import"./@supabase-9ce37a4a.js";import"./pinia-b2002cd0.js";import"./@googlemaps-b4d342ab.js";import"./fast-deep-equal-099ec698.js";import"./apexcharts-clevision-d64c90db.js";import"./supercluster-6504d485.js";import"./kdbush-ac640998.js";import"./pica-f1c996d9.js";import"./@kurkle-b1b89bbc.js";const pe={__name:"ReportChart",props:{chartData:{type:Object,required:!0}},setup(m){const u=m,l=w(null);let r=null;const _=()=>{r&&r.destroy(),r=new le(l.value,{type:"bar",data:u.chartData,options:{responsive:!0,maintainAspectRatio:!1}})};return Q(()=>{_()}),W(()=>u.chartData,()=>{_()},{deep:!0}),(O,i)=>(n(),v("div",null,[p("canvas",{ref_key:"chart",ref:l},null,512)]))}},me=G(pe,[["__scopeId","data-v-40bfd3d1"]]);const fe={__name:"ReportTable",props:{tableData:{type:Array,required:!0}},setup(m){const u=m,l=M(()=>u.tableData.length>0?Object.keys(u.tableData[0]):[]),r=M(()=>u.tableData);return(_,O)=>(n(),S(ee,{height:"500","fixed-header":"",density:"compact"},{default:t(()=>[p("thead",null,[p("tr",null,[(n(!0),v(C,null,J(l.value,i=>(n(),v("th",{key:i,class:"text-uppercase"},F(i),1))),128))])]),p("tbody",null,[(n(!0),v(C,null,J(r.value,(i,d)=>(n(),v("tr",{key:d},[(n(!0),v(C,null,J(l.value,R=>(n(),v("td",{key:R,class:"text-center"},F(i[R]),1))),128))]))),128))])]),_:1}))}},_e=G(fe,[["__scopeId","data-v-15bdfb94"]]);const be={key:0,class:"chart-wrapper"},ve={key:1,class:"chart-wrapper"},ye={__name:"ShowDetailsReporteForm",props:{reporte:{type:Object,required:!0},isOpen:{type:Boolean,required:!0}},emits:["update:isOpen"],setup(m,{emit:u}){const l=m,r=w({}),_=w([]),O=["Obras actuales","Tareas actuales","Resumen de obras","Personal asignado por tipo de Obra"],i=["Distribución de personal por tipo de obra.","Gráfico de estado de Obras","Estado de las tareas vs número de tareas.","Estado de las obras vs tipo de Obra"],d=async a=>{try{const o=await g.get(`http://desarrollo-constructora-back.onrender.com/constructora/v1/Reporte/${a}/`);r.value=o.data,console.log("Reporte Details:",r.value),O.includes(r.value.contenido)?y():i.includes(r.value.contenido)&&c()}catch(o){console.error("Error al obtener los detalles del reporte:",o)}};W(()=>l.isOpen,a=>{a&&d(l.reporte.reporteid)},{immediate:!0});const R=w({}),c=async()=>{try{const a=r.value.reporteid,s=await(await z("Grafico",a)).text(),f=JSON.parse(s);R.value={labels:f.labels,datasets:f.datasets},console.log("Chart Data:",R.value)}catch(a){console.error("Error fetching chart data:",a)}},b=a=>Array.isArray(a)?a:typeof a=="object"?Object.values(a):[],y=async()=>{try{const a=r.value.reporteid,s=await(await z("Texto",a)).text();_.value=b(JSON.parse(s)),console.log("Table Data:",_.value)}catch(a){console.error("Error fetching table data:",a),_.value=[]}},D=()=>{u("update:isOpen",!1)};return(a,o)=>(n(),S(oe,{"model-value":m.isOpen,"onUpdate:modelValue":D},{default:t(()=>[e($,{justify:"center"},{default:t(()=>[e(V,{cols:"12",md:"8"},{default:t(()=>[e(E,null,{default:t(()=>[e(q,{class:"headline"},{default:t(()=>[x(" Detalles del Reporte ")]),_:1}),e(N,null,{default:t(()=>[r.value?(n(),S(te,{key:0},{default:t(()=>[e($,null,{default:t(()=>[e(V,{cols:"12",md:"8"},{default:t(()=>[e(j,{modelValue:r.value.reporteid,"onUpdate:modelValue":o[0]||(o[0]=s=>r.value.reporteid=s),label:"Reporte ID",readonly:""},null,8,["modelValue"])]),_:1}),e(V,{cols:"12",md:"3"},{default:t(()=>[e(j,{modelValue:r.value.tipo,"onUpdate:modelValue":o[1]||(o[1]=s=>r.value.tipo=s),label:"Tipo de Reporte",readonly:""},null,8,["modelValue"])]),_:1}),e(V,{cols:"12",md:"7"},{default:t(()=>[e(j,{modelValue:r.value.contenido,"onUpdate:modelValue":o[2]||(o[2]=s=>r.value.contenido=s),label:"Contenido del Reporte",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):A("",!0),e(B),e(V,{cols:"12",md:"12"},{default:t(()=>[r.value.tipo==="Gráfico"?(n(),v("div",be,[e(me,{"chart-data":R.value},null,8,["chart-data"])])):A("",!0),r.value.tipo==="Texto"?(n(),v("div",ve,[e(_e,{"table-data":_.value},null,8,["table-data"])])):A("",!0)]),_:1})]),_:1}),e(ae,null,{default:t(()=>[e(B),e(T,{color:"blue darken-1",onClick:D},{default:t(()=>[x(" Cerrar ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},he=G(ye,[["__scopeId","data-v-ec2941a8"]]);const we=m=>(Y("data-v-f2308ed6"),m=m(),Z(),m),Oe=we(()=>p("thead",null,[p("tr",null,[p("th",{class:"text-uppercase"},"ReporteID"),p("th",{class:"text-uppercase"},"Tipo"),p("th",null,"Contenido"),p("th",null,"Acciones")])],-1)),xe={class:"text-center"},ge={class:"text-center"},Ve={__name:"EditableReporteList",setup(m){const u=w([]),l=w({}),r=w(!1),_=w(!1),O=async()=>{try{const c=await g.get("http://desarrollo-constructora-back.onrender.com/constructora/v1/Reporte/");u.value=c.data}catch(c){console.error("Error al obtener los reportes:",c)}},i=c=>{l.value={...c},r.value=!0},d=c=>{l.value={...c},_.value=!0},R=async()=>{try{const c=l.value;try{await se(c.tipo,c.reporteid)}catch(b){if(b.response&&b.response.status===404)console.warn("El archivo no existe, se procederá a eliminar el reporte de la base de datos.");else throw b}await g.delete(`http://desarrollo-constructora-back.onrender.com/constructora/v1/Reporte/${c.reporteid}/`),u.value=u.value.filter(b=>b.reporteid!==c.reporteid),L.emit("reporte-deleted")}catch(c){console.error("Error al eliminar el reporte:",c)}finally{_.value=!1}};return Q(()=>{O(),L.on("reporte-create",O)}),(c,b)=>(n(),v(C,null,[e($,null,{default:t(()=>[e(V,{cols:"12"},{default:t(()=>[e(E,null,{default:t(()=>[e(q,null,{default:t(()=>[x(" Lista de Reportes ")]),_:1}),e(N,null,{default:t(()=>[e(ee,null,{default:t(()=>[Oe,p("tbody",null,[(n(!0),v(C,null,J(u.value,y=>(n(),v("tr",{key:y.reporteid},[p("td",null,F(y.reporteid),1),p("td",null,F(y.tipo),1),p("td",xe,F(y.contenido),1),p("td",ge,[e(T,{icon:"",style:{marginLeft:"0.5rem"},onClick:D=>i(y)},{default:t(()=>[e(I,null,{default:t(()=>[x("mdi-eye")]),_:1})]),_:2},1032,["onClick"]),e(T,{icon:"",color:"error",style:{marginLeft:"0.5rem",marginRight:"0.5rem"},onClick:D=>d(y)},{default:t(()=>[e(I,null,{default:t(()=>[x("mdi-delete")]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(he,{isOpen:r.value,"onUpdate:isOpen":b[0]||(b[0]=y=>r.value=y),reporte:l.value},null,8,["isOpen","reporte"]),e(oe,{modelValue:_.value,"onUpdate:modelValue":b[2]||(b[2]=y=>_.value=y),"max-width":"500px"},{default:t(()=>[e(E,null,{default:t(()=>[e(q,{class:"headline"},{default:t(()=>[x(" Confirmar Eliminación ")]),_:1}),e(N,null,{default:t(()=>[x(" ¿Estás seguro de que deseas eliminar este reporte? ")]),_:1}),e(ae,null,{default:t(()=>[e(B),e(T,{color:"blue darken-1",text:"",onClick:b[1]||(b[1]=y=>_.value=!1)},{default:t(()=>[x(" Cancelar ")]),_:1}),e(T,{color:"blue darken-1",text:"",onClick:R},{default:t(()=>[x(" Confirmar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Re=G(Ve,[["__scopeId","data-v-f2308ed6"]]),ke=p("code",null,"Reportes",-1),Ce={__name:"ReporteList",setup(m){return(u,l)=>(n(),S($,null,{default:t(()=>[e(V,{cols:"12"},{default:t(()=>[e(E,{title:"Reportes"},{default:t(()=>[e(N,null,{default:t(()=>[ke]),_:1}),e(Re)]),_:1})]),_:1})]),_:1}))}};const De=m=>(Y("data-v-404533d2"),m=m(),Z(),m),Te={class:"d-flex flex-column gap-5"},Se={class:"text-body-1 mb-0",style:{color:"darkred"}},Fe=De(()=>p("p",{class:"text-body-1 mb-0"}," Completa los siguientes campos para añadir un reporte ",-1)),Ne={__name:"ReporteCreate",setup(m){const u=w(""),l=a=>{const o=document.getElementById("errorItem");u.value=a,o.style.display="block",window.scroll({top:0,left:0,behavior:"smooth"}),setTimeout(()=>{o.style.display="none"},2e3)},r=w([]),_=["Texto","Gráfico"],O=["Obras actuales","Tareas actuales","Resumen de obras","Personal asignado por tipo de Obra"],i=["Distribución de personal por tipo de obra.","Gráfico de estado de Obras","Estado de las tareas vs número de tareas.","Estado de las obras vs tipo de Obra"],d=w({tipo:"",contenido:""}),R=w(null),c=w(!1),b=async()=>{if(d.value.tipo=="")l("Debe definir el tipo de reporte");else if(d.value.contenido=="")l("Debe definir el contenido del informe");else{c.value=!0;try{const a={tipo:d.value.tipo,contenido:d.value.contenido},o=await g.post("http://desarrollo-constructora-back.onrender.com/constructora/v1/Reporte/",a);r.value.push(o.data),await y(o.data.reporteid,d.value.contenido),D()}catch(a){console.error("Error al crear el reporte:",a)}finally{c.value=!1}}},y=async(a,o)=>{try{if(o==="Obras actuales"){const f=(await g.get("http://desarrollo-constructora-back.onrender.com/constructora/v1/Obra/")).data,h=JSON.stringify(f);await k("Texto",a,new File([h],`${a}.json`))}if(o==="Tareas actuales"){const f=(await g.get("http://desarrollo-constructora-back.onrender.com/constructora/v1/Tarea/")).data,h=JSON.stringify(f);await k("Texto",a,new File([h],`${a}.json`))}if(o==="Resumen de obras"){const f=(await g.get("http://desarrollo-constructora-back.onrender.com/constructora/v1/obras-detailed/detailed-info/")).data,h=JSON.stringify(f);await k("Texto",a,new File([h],`${a}.json`))}if(o==="Personal asignado por tipo de Obra"){const f=(await g.get("http://desarrollo-constructora-back.onrender.com/constructora/v1/obras-detailed/summary-by-type/")).data,h=JSON.stringify(f);await k("Texto",a,new File([h],`${a}.json`))}if(o==="Distribución de personal por tipo de obra."){const f=(await g.get("http://desarrollo-constructora-back.onrender.com/constructora/v1/obras-detailed/summary-by-typechart/")).data,h=JSON.stringify(f);await k("Grafico",a,new File([h],`${a}.json`))}if(o==="Gráfico de estado de Obras"){const f=(await g.get("http://desarrollo-constructora-back.onrender.com/constructora/v1/obras-detailed/summary-by-state-tarea/")).data,h=JSON.stringify(f);await k("Grafico",a,new File([h],`${a}.json`))}if(o==="Estado de las tareas vs número de tareas."){const f=(await g.get("http://desarrollo-constructora-back.onrender.com/constructora/v1/obras-detailed/tareas-obra/")).data,h=JSON.stringify(f);await k("Grafico",a,new File([h],`${a}.json`))}if(o==="Estado de las obras vs tipo de Obra"){const f=(await g.get("http://desarrollo-constructora-back.onrender.com/constructora/v1/obras-detailed/summary-by-type-and-state/")).data,h=JSON.stringify(f);await k("Grafico",a,new File([h],`${a}.json`))}L.emit("reporte-create")}catch(s){throw console.error("Error al subir el archivo de datos del reporte:",s),s}},D=()=>{d.value={tipo:"",contenido:"",tareaid:""}};return W(()=>d.value.tipo,()=>{d.value.contenido=""}),(a,o)=>(n(),S($,{justify:"center"},{default:t(()=>[e(V,{cols:"12",md:"6"},{default:t(()=>[e(E,{style:{"margin-bottom":"1vh",display:"none"},id:"errorItem"},{default:t(()=>[e(N,null,{default:t(()=>[p("form",Te,[p("p",Se,F(u.value),1)])]),_:1})]),_:1}),e(E,{title:"Crear Reporte"},{default:t(()=>[e(N,null,{default:t(()=>[Fe]),_:1}),e(P),e(N,null,{default:t(()=>[e(te,{ref_key:"form",ref:R,class:"mt-6"},{default:t(()=>[e($,null,{default:t(()=>[e(V,{cols:"12",md:"6"},{default:t(()=>[e(U,{modelValue:d.value.tipo,"onUpdate:modelValue":o[0]||(o[0]=s=>d.value.tipo=s),items:_,label:"Tipo de Reporte",required:""},null,8,["modelValue"])]),_:1}),e(V,{cols:"12",md:"6"},{default:t(()=>[d.value.tipo==="Texto"?(n(),S(U,{key:0,modelValue:d.value.contenido,"onUpdate:modelValue":o[1]||(o[1]=s=>d.value.contenido=s),items:O,label:"Contenido del Reporte",required:""},null,8,["modelValue"])):d.value.tipo==="Gráfico"?(n(),S(U,{key:1,modelValue:d.value.contenido,"onUpdate:modelValue":o[2]||(o[2]=s=>d.value.contenido=s),items:i,label:"Contenido del Reporte",required:""},null,8,["modelValue"])):A("",!0)]),_:1}),e(V,{cols:"12",class:"d-flex flex-wrap gap-4 justify-end"},{default:t(()=>[e(T,{type:"submit",color:"primary",class:"mt-4",disabled:c.value,onClick:ne(b,["prevent"])},{default:t(()=>[c.value?(n(),v(C,{key:0},[e(de,{indeterminate:"",size:"20"}),x(" Guardando... ")],64)):(n(),v(C,{key:1},[x(" Guardar ")],64))]),_:1},8,["disabled","onClick"]),e(T,{color:"secondary",variant:"tonal",type:"reset",class:"mt-4",onClick:D},{default:t(()=>[x(" Resetear ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1}),e(P)]),_:1})]),_:1})]),_:1}))}},$e=G(Ne,[["__scopeId","data-v-404533d2"]]),Ze={__name:"reportes-management",setup(m){const u=re(),l=w(u.params.tab),r=[{title:"Lista de reportes",icon:"bx-hard-hat",tab:"reportes"},{title:"Crear Reporte",icon:"bx-user-pin",tab:"create"}];return(_,O)=>(n(),v("div",null,[e(ce,{modelValue:H(l),"onUpdate:modelValue":O[0]||(O[0]=i=>X(l)?l.value=i:null),"show-arrows":""},{default:t(()=>[(n(),v(C,null,J(r,i=>e(ue,{key:i.icon,value:i.tab},{default:t(()=>[e(I,{size:"20",start:"",icon:i.icon},null,8,["icon"]),x(" "+F(i.title),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"]),e(P),e(ie,{modelValue:H(l),"onUpdate:modelValue":O[1]||(O[1]=i=>X(l)?l.value=i:null),class:"mt-5 disable-tab-transition"},{default:t(()=>[e(K,{value:"create"},{default:t(()=>[e($e)]),_:1}),e(K,{value:"reportes"},{default:t(()=>[e(Ce)]),_:1})]),_:1},8,["modelValue"])]))}};export{Ze as default};
